```markdown
# 聊天系统项目文档

## 1. 项目概述
- **项目名称**: 聊天系统
- **版本**: 1.0.0
- **开发环境**:
  - 服务器: Apache/Nginx
  - 编程语言: PHP 7.4+
  - 数据库: MySQL 5.7+
  - 前端: HTML5, CSS3, JavaScript (jQuery)
  - API: 兼容OpenAI，接口域名: https://gtp.6qu.cc
- **数据库表前缀**: lq_

## 2. 功能模块

### 普通用户模块
#### 1. 用户注册
- 功能描述: 用户可以通过注册页面创建新账户。
- 技能要求: 
  - 验证用户名、密码、邮箱的唯一性和格式。
  - 用户注册后需要激活账户（可选）。
- 功能流程:
  1. 用户访问注册页面。
  2. 填写用户名、密码和邮箱。
  3. 提交注册信息。
  4. 系统验证数据并发送激活邮件（如果启用了邮箱验证）。
  5. 用户激活账户后可登录。

#### 2. 用户登录
- 功能描述: 用户通过用户名和密码登录系统。
- 技能要求:
  - 支持记住密码功能（可选）。
  - 验证用户的登录权限。
- 功能流程:
  1. 用户访问登录页面。
  2. 填写用户名和密码。
  3. 提交登录信息。
  4. 系统验证用户身份，创建会话并跳转至聊天界面。

#### 3. 聊天界面
- 功能描述: 用户可以发送和接收消息。
- 技能要求:
  - 支持实时消息的发送和接收。
  - 消息记录的存储和显示。
- 功能流程:
  1. 用户登录后进入聊天界面。
  2. 用户输入消息并发送。
  3. 系统通过API发送消息并接收回复。
  4. 显示消息记录，支持分页或无限滚动加载。

#### 4. 模型切换
- 功能描述: 用户可以选择不同的模型进行聊天。
- 技能要求:
  - 从后台获取可用模型列表。
  - 支持动态切换聊天模型。
- 功能流程:
  1. 系统从/v1/models获取可用模型。
  2. 显示模型列表供用户选择。
  3. 用户选择模型，系统记录选择并在后续API调用中使用。

### 后台管理模块
#### 1. 系统设置
- 功能描述: 管理系统配置，如API_KEY。
- 技能要求:
  - 提供用户友好的界面编辑系统配置。
  - 配置的实时生效。
- 功能流程:
  1. 管理员登录后台。
  2. 访问系统设置页面。
  3. 修改API_KEY并保存。

#### 2. 用户管理
- 功能描述: 管理普通用户账户。
- 技能要求:
  - 支持对用户的增删改查操作。
  - 支持用户列表的分页显示。
- 功能流程:
  1. 管理员访问用户管理页面。
  2. 查看用户列表，支持筛选、排序、分页。
  3. 删除或编辑用户信息。

#### 3. 日志管理
- 功能描述: 查看系统操作日志。
- 技能要求:
  - 存储系统操作日志。
  - 支持日志的查询和导出。
- 功能流程:
  1. 管理员访问日志页面。
  2. 查看操作记录，支持筛选、排序、分页。

#### 4. 模型管理
- 功能描述: 管理可用模型。
- 技能要求:
  - 从API获取模型列表并显示。
  - 支持对模型的启用和禁用。
- 功能流程:
  1. 管理员访问模型管理页面。
  2. 查看模型列表，支持启用或禁用模型。

## 3. 技术实现

### 核心功能

#### 1. 用户模块
- **注册**:
  - 验证用户名唯一性、邮箱格式。
  - 加密密码存储。
- **登录**:
  - 验证用户凭据，创建Session。
  - 防止重复登录。

#### 2. 聊天功能
- **消息发送**:
  - 使用AJAX提交消息。
  - 调用OpenAI API获取回复。
- **消息显示**:
  - 在聊天界面实时显示消息。
  - 支持 emojis 表情。

#### 3. 模型管理
- **获取模型**:
  - 调用/v1/models接口获取可用模型。
- **切换模型**:
  - 动态调整API调用中的模型参数。

#### 4. 系统设置
- **API_KEY管理**:
  - 在后台设置API_KEY。
  - 验证KEY的有效性。

### 数据库设计

#### 数据库表结构

##### 用户表(lq_user)
| 字段名   | 类型        | 注释         |
|----------|-------------|--------------|
| id       | int(11)     | 主键，自动增量 |
| username | varchar(50) | 用户名       |
| password | varchar(255)| 加密密码     |
| email    | varchar(100)| 邮箱         |
| created_at | timestamp  | 注册时间     |
| updated_at | timestamp  | 更新时间     |

##### 消息表(lq_message)
| 字段名   | 类型        | 注释         |
|----------|-------------|--------------|
| id       | int(11)     | 主键，自动增量 |
| content  | text        | 消息内容     |
| sender   | int(11)     | 发送者ID     |
| receiver | int(11)     | 接收者ID     |
| created_at | timestamp  | 发送时间     |

##### 系统设置表(lq_system_config)
| 字段名     | 类型        | 注释               |
|------------|-------------|--------------------|
| id         | int(11)     | 主键，自动增量     |
| config_key | varchar(50) | 配置键             |
| config_value | text      | 配置值             |
| created_at | timestamp   | 创建时间           |
| updated_at | timestamp   | 更新时间           |

##### 日志表(lq_log)
| 字段名     | 类型        | 注释               |
|------------|-------------|--------------------|
| id         | int(11)     | 主键，自动增量     |
| action     | varchar(50) | 操作类型           |
| user_id    | int(11)     | 操作用户ID         |
| created_at | timestamp   | 操作时间           |

### 浏览器适配

- **响应式设计**:
  - 使用Bootstrap或其他响应式框架。
  - 确保聊天界面在手机和电脑上都有良好的显示。
- **布局调整**:
  - 在手机端，顶部显示消息，底部显示输入框。
  - 在电脑端，可能采用更宽的布局。

### 安全考虑

- **XSS防护**:
  - 对用户输入进行过滤和转义。
  - 使用prepared statements防止SQL注入。
- **CSRF保护**:
  - 在表单中添加CSRF token。
  - 验证token以防止跨站请求伪造。
- **数据加密**:
  - 密码存储时使用强加密（如bcrypt）。
  - 敏感数据加密传输（HTTPS）。

### 测试和部署

#### 测试
- **单元测试**:
  - 测试每个功能模块的正确性。
- **集成测试**:
  - 测试模块间交互和流程。
- **用户测试**:
  - 邀请用户参与测试，收集反馈。

#### 部署
1. 服务器配置:
   - 配置Apache或Nginx支持PHP运行环境。
2. 数据库部署:
   - 导入SQL文件创建数据库和表结构。
3. 项目部署:
   - 上传项目文件到服务器。
   - 配置域名解析和HTTPS。
4. 性能优化:
   - 启用缓存机制。
   - 优化数据库查询。

## 4. 用户手册

### 1. 安装配置
- 克隆或下载源码。
- 配置数据库连接。
- 导入数据库结构。
- 配置API_KEY。

### 2. 功能使用
- 访问注册页面创建账户。
- 登录进入聊天界面。
- 选择模型开始聊天。

### 3. 后台管理
- 访问管理页面（如/admin）。
- 使用管理员账户登录。
- 配置系统设置、管理用户和日志。

## 5. API文档

### 模型接口
- **GET /v1/models**:
  - 获取可用模型列表。

### 聊天接口
- **POST /v1/chat**:
  - 发送消息并获取回复。

## 6. 项目结构
```
project/
├── app/
│   ├── controllers/
│   │   ├── UserController.php
│   │   ├── ChatController.php
│   │   └── AdminController.php
│   ├── models/
│   │   ├── UserModel.php
│   │   ├── MessageModel.php
│   │   └── SystemConfigModel.php
│   └── views/
│       ├── user/
│       │   ├── register.php
│       │   └── login.php
│       ├── chat/
│       │   └── index.php
│       └── admin/
│           ├── dashboard.php
│           ├── system config.php
│           ├── user manage.php
│           └── log.php
├── public/
│   ├── index.php
│   └── assets/
│       ├── css/
│       ├── js/
│       └── images/
└── config/
    ├── database.php
    └── routes.php
```

## 7. 开发说明

### 1. 开发工具
- 编辑器: PHPStorm, VSCode
- 数据库管理工具: PhpMyAdmin, Navicat

### 2. 开发流程
- 需求分析。
- 系统设计。
- 编码实现。
- 测试。
- 部署。

### 3. 团队协作
- 使用Git进行版本控制。
- 分支开发与合并。

如果有任何疑问或需要进一步调整，请随时联系我们。
```
